<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Shader drop</title>
  <style>
    #demo-div {
      color: lightgrey;
      border-radius: 0.3rem;
    }

    #demo-div span,
    #demo-div #num-observed-events {
      color: black;
    }

    h1 {
      margin-top: 0.5rem;
    }

    h4 {
      margin-top: 0.66rem;
      font-size: 1.33rem;
    }

    #demo-div li {
      line-height: 21px;
    }

    #demo-div ul {
      margin-bottom: 0.66rem;
    }
  </style>
</head>

<body>
  <main role="main" class="container">

    <h1 align="left">JavaScript Sensor Access Demo</h1>
    <script id="vertexShader" type="x-shader/x-vertex">
      uniform float time;
      uniform vec2 resolution;
      uniform vec3 dropPosition;
      void main()	{
          gl_Position = vec4(position, 1.0 );
      }
    </script>

  <script id="fragmentShader" type="x-shader/x-fragment">
      uniform vec2 resolution;
      uniform float time;
      uniform vec3 dropPosition;

      void main() {
        // center the shader
        vec2 st = gl_FragCoord.xy/resolution.xy - vec2(0.5);
        vec3 color = vec3(0.5);


        // shader functionality
        //float x = mod(time + gl_FragCoord.x, 20.) < 10. ? 1. : 0.;
        //float y = mod(time + gl_FragCoord.y, 20.) < 10. ? 1. : 0.;
        //color = vec3(min(x, y));


        // color for position
        if (st.x > dropPosition.x) {color = vec3(0,0,1);}
        //if (st.y > dropPosition.y) {color = vec3(1,0,0);}

        // color the frame we can see that it take up the whole screen.
        if (st.x > 0.99) {color = vec3(0,0,1);}
        if (st.x < 0.01) {color = vec3(1,0,0);}
        if (st.y > 0.99) {color = vec3(0,0,1);}
        if (st.y < 0.01) {color = vec3(1,0,0);}

        // make cross
        if (st.x > 0.45 && st.x < 0.55) {color = vec3(1,1,1);}
        if (st.y > 0.45 && st.y < 0.55) {color = vec3(1,1,1);}

        // make moving cross
        //if (st.x > dropPosition.x && st.x < dropPosition.x+0.1) {color = vec3(1,0,0);}
        //if (st.y > dropPosition.y && st.y < dropPosition.y+0.1) {color = vec3(0,1,0);}
        //color = vec3(dropPosition.x);

        gl_FragColor = vec4(color, 1.);
    }
   </script>

   <script type="module">
    import * as THREE from './build/three.module.js'
    console.log("hello");

    let scene, renderer, controls;
    var startTime;
    var uniforms, material2, mesh2;
    let camera2;
    init();
    animate();
    startTime = Date.now();

    function init() {
      /* SETUP */
      camera2 = new THREE.Camera();
      camera2.position.z = 1;
      scene = new THREE.Scene();

      /* SHADER STUFF */
      uniforms = {
        time: { type: "f", value: 1.0 },
        resolution: { type: "v2", value: new THREE.Vector2() },
        dropPosition: { type: "v2", value: new THREE.Vector2() }
      };

      material2 = new THREE.ShaderMaterial({
        uniforms: uniforms,
        vertexShader: document.getElementById('vertexShader').textContent,
        fragmentShader: document.getElementById('fragmentShader').textContent
      });

      mesh2 = new THREE.Mesh(new THREE.PlaneGeometry(1, 1), material2);
      scene.add(mesh2);

      uniforms.resolution.value.x = window.innerWidth;
      uniforms.resolution.value.y = window.innerHeight;
      uniforms.dropPosition.value.x = 0.5;
      uniforms.dropPosition.value.y = 0.5;
      uniforms.dropPosition.value.z = 0.5;
      /* END SHADER STUFF */

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      window.addEventListener('resize', onWindowResize, false);
    }

    function animate() {
      window.requestAnimationFrame(animate);
      render();
    }
    
    function render() {
      var elapsedMilliseconds = Date.now() - startTime;
      var elapsedSeconds = elapsedMilliseconds / 1000.;
      uniforms.time.value = 60. * elapsedSeconds;
      
      //uniforms.dropPosition.value.x = camera.getWorldDirection().x;
      //uniforms.dropPosition.value.y = camera.getWorldDirection().y;
      //uniforms.dropPosition.value.y = camera.getWorldDirection().z;

      // render static cam
      renderer.render(scene, camera2);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      uniforms.resolution.value.x = window.innerWidth;
      uniforms.resolution.value.y = window.innerHeight;
      renderer.setSize(window.innerWidth, window.innerHeight);      
    }
  </script>

    <div class="p-3 mb-2 bg-secondary" id="demo-div">
      <a id="start_demo" class="btn btn-lg btn-success py-1" href="#" role="button">Start the demo</a>
      <p style="margin-top:1rem;">Num. of datapoints: <span class="badge badge-warning"
          id="num-observed-events">0</span></p>


      <h4 style="margin-top:0.75rem;">Orientation</h4>
      <ul>
        <li>X-axis (&beta;): <span id="Orientation_b">0</span><span>&deg;</span></li>
        <li>Y-axis (&gamma;): <span id="Orientation_g">0</span><span>&deg;</span></li>
        <li>Z-axis (&alpha;): <span id="Orientation_a">0</span><span>&deg;</span></li>
      </ul>
      <!--
      <h4>Accelerometer</h4>
      <ul>
        <li>X-axis: <span id="Accelerometer_x">0</span><span> m/s<sup>2</sup></span></li>
        <li>Y-axis: <span id="Accelerometer_y">0</span><span> m/s<sup>2</sup></span></li>
        <li>Z-axis: <span id="Accelerometer_z">0</span><span> m/s<sup>2</sup></span></li>
        <li>Data Interval: <span id="Accelerometer_i">0</span><span> ms</span></li>
      </ul>

      <h4>Accelerometer including gravity</h4>
      <ul>
        <li>X-axis: <span id="Accelerometer_gx">0</span><span> m/s<sup>2</sup></span></li>
        <li>Y-axis: <span id="Accelerometer_gy">0</span><span> m/s<sup>2</sup></span></li>
        <li>Z-axis: <span id="Accelerometer_gz">0</span><span> m/s<sup>2</sup></span></li>
      </ul>

      <h4>Gyroscope</h4>
      <ul>
        <li>X-axis: <span id="Gyroscope_x">0</span><span>&deg;/s</span></li>
        <li>Y-axis: <span id="Gyroscope_y">0</span><span>&deg;/s</span></li>
        <li>Z-axis: <span id="Gyroscope_z">0</span><span>&deg;/s</span></li>
      </ul>
      -->
    </div>
  </main>

  <script>
    function handleOrientation(event) {
      updateFieldIfNotNull('Orientation_a', event.alpha);
      updateFieldIfNotNull('Orientation_b', event.beta);
      updateFieldIfNotNull('Orientation_g', event.gamma);
      incrementEventCount();
    }

    function incrementEventCount() {
      let counterElement = document.getElementById("num-observed-events")
      let eventCount = parseInt(counterElement.innerHTML)
      counterElement.innerHTML = eventCount + 1;
    }

    function updateFieldIfNotNull(fieldName, value, precision = 10) {
      if (value != null)
        document.getElementById(fieldName).innerHTML = value.toFixed(precision);
    }

    function handleMotion(event) {
      updateFieldIfNotNull('Accelerometer_gx', event.accelerationIncludingGravity.x);
      updateFieldIfNotNull('Accelerometer_gy', event.accelerationIncludingGravity.y);
      updateFieldIfNotNull('Accelerometer_gz', event.accelerationIncludingGravity.z);

      updateFieldIfNotNull('Accelerometer_x', event.acceleration.x);
      updateFieldIfNotNull('Accelerometer_y', event.acceleration.y);
      updateFieldIfNotNull('Accelerometer_z', event.acceleration.z);

      updateFieldIfNotNull('Accelerometer_i', event.interval, 2);

      updateFieldIfNotNull('Gyroscope_z', event.rotationRate.alpha);
      updateFieldIfNotNull('Gyroscope_x', event.rotationRate.beta);
      updateFieldIfNotNull('Gyroscope_y', event.rotationRate.gamma);
      incrementEventCount();
    }

    let is_running = false;
    let demo_button = document.getElementById("start_demo");
    demo_button.onclick = function (e) {
      e.preventDefault();
      // Request permission for iOS 13+ devices
      if (
        DeviceMotionEvent &&
        typeof DeviceMotionEvent.requestPermission === "function"
      ) {
        DeviceMotionEvent.requestPermission();
      }

      if (is_running) {
        //window.removeEventListener("devicemotion", handleMotion);
        window.removeEventListener("deviceorientation", handleOrientation);
        demo_button.innerHTML = "Start demo";
        demo_button.classList.add('btn-success');
        demo_button.classList.remove('btn-danger');
        is_running = false;
      } else {
        //window.addEventListener("devicemotion", handleMotion);
        window.addEventListener("deviceorientation", handleOrientation);
        document.getElementById("start_demo").innerHTML = "Stop demo";
        demo_button.classList.remove('btn-success');
        demo_button.classList.add('btn-danger');
        is_running = true;
      }
    };
  </script>
</body>
</html>


<!--
<!DOCTYPE html>
<html lang="en">

<head>
  <title>Shader drop</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link type="text/css" rel="stylesheet" href="main.css">
</head>

<body>
  <div id="overlay">
    <button id="startButton">Start Demo</button>
  </div>
  <div id="info">
    <a rel="noopener">Drop shader<br /></a>
  </div>

  <script id="vertexShader" type="x-shader/x-vertex">
      uniform float time;
      uniform vec2 resolution;
      uniform vec3 dropPosition;
      void main()	{
          gl_Position = vec4(position, 1.0 );
      }
    </script>

  <script id="fragmentShader" type="x-shader/x-fragment">
      uniform vec2 resolution;
      uniform float time;
      uniform vec3 dropPosition;

      void main() {
        // center the shader
        vec2 st = gl_FragCoord.xy/resolution.xy - vec2(0.5);
        vec3 color = vec3(0.5);


        // shader functionality
        //float x = mod(time + gl_FragCoord.x, 20.) < 10. ? 1. : 0.;
        //float y = mod(time + gl_FragCoord.y, 20.) < 10. ? 1. : 0.;
        //color = vec3(min(x, y));


        // color for position
        if (st.x > dropPosition.x) {color = vec3(0,0,1);}
        //if (st.y > dropPosition.y) {color = vec3(1,0,0);}

        // color the frame we can see that it take up the whole screen.
        if (st.x > 0.99) {color = vec3(0,0,1);}
        if (st.x < 0.01) {color = vec3(1,0,0);}
        if (st.y > 0.99) {color = vec3(0,0,1);}
        if (st.y < 0.01) {color = vec3(1,0,0);}

        // make cross
        if (st.x > 0.45 && st.x < 0.55) {color = vec3(1,1,1);}
        if (st.y > 0.45 && st.y < 0.55) {color = vec3(1,1,1);}

        // make moving cross
        //if (st.x > dropPosition.x && st.x < dropPosition.x+0.1) {color = vec3(1,0,0);}
        //if (st.y > dropPosition.y && st.y < dropPosition.y+0.1) {color = vec3(0,1,0);}
        //color = vec3(dropPosition.x);

        gl_FragColor = vec4(color, 1.);
    }
   </script>

  <script type="module">

    import * as THREE from './build/three.module.js'
    import { DeviceOrientationControls } from './jsm/controls/DeviceOrientationControls.js';
    console.log("hello");

    let camera, scene, renderer, controls;
    var startTime;
    var uniforms, material2, mesh2;
    let camera2;

    //const startButton = document.getElementById('startButton');
    //startButton.addEventListener('click', function () {
      init();
      animate();
      startTime = Date.now();
    //}, false);

    function init() {
      /* SETUP */
      const overlay = document.getElementById('overlay');
      overlay.remove();

      camera2 = new THREE.Camera();
      camera2.position.z = 1;

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1100);
      
      
      controls = new DeviceOrientationControls(camera);
      scene = new THREE.Scene();


      /* GEOMETRICAL LINES */
      /*
      const helperGeometry = new THREE.BoxBufferGeometry( 100, 100, 100, 4, 4, 4 );
      const helperMaterial = new THREE.MeshBasicMaterial( { color: 0xff00ff, wireframe: true } );
      const helper = new THREE.Mesh( helperGeometry, helperMaterial );
      scene.add( helper );
      */

      /* SHADER STUFF */
      uniforms = {
        time: { type: "f", value: 1.0 },
        resolution: { type: "v2", value: new THREE.Vector2() },
        dropPosition: { type: "v2", value: new THREE.Vector2() }
      };

      material2 = new THREE.ShaderMaterial({
        uniforms: uniforms,
        vertexShader: document.getElementById('vertexShader').textContent,
        fragmentShader: document.getElementById('fragmentShader').textContent
      });

      mesh2 = new THREE.Mesh(new THREE.PlaneGeometry(1, 1), material2);
      scene.add(mesh2);

      uniforms.resolution.value.x = window.innerWidth;
      uniforms.resolution.value.y = window.innerHeight;
      uniforms.dropPosition.value.x = 0.5;
      uniforms.dropPosition.value.y = 0.5;
      uniforms.dropPosition.value.z = 0.5;
      /* END SHADER STUFF */


      /*
      const geometry = new THREE.SphereBufferGeometry(500, 60, 40);
      // invert the geometry on the x-axis so that all of the faces point inward
      geometry.scale(- 1, 1, 1);

      const material = new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('textures/2294472375_24a3b8ef46_o.jpg')
      });

      const mesh = new THREE.Mesh(geometry, material);
      scene.add(mesh);
      */

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      window.addEventListener('resize', onWindowResize, false);
    }

    function animate() {
      window.requestAnimationFrame(animate);
      controls.update();
      render();
    }

    function render() {
      var elapsedMilliseconds = Date.now() - startTime;
      var elapsedSeconds = elapsedMilliseconds / 1000.;
      uniforms.time.value = 60. * elapsedSeconds;
      console.log(controls.object.rotation);
      let camTarget;
  
      camera.getWorldDirection(camTarget);
      console.log(camTarget);
      //uniforms.dropPosition.value.x = camera.getWorldDirection().x;
      //uniforms.dropPosition.value.y = camera.getWorldDirection().y;
      //uniforms.dropPosition.value.y = camera.getWorldDirection().z;
      // render static cam
      renderer.render(scene, camera);
      renderer.render(scene, camera2);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      uniforms.resolution.value.x = window.innerWidth;
      uniforms.resolution.value.y = window.innerHeight;
      renderer.setSize(window.innerWidth, window.innerHeight);      
    }
  </script>


</body>

</html>

-->


<!--

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <style>
    body {
      margin: 0px;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div id="container"></div>
  <script src="build/three.min.js"></script>
  
  <script id="vertexShader" type="x-shader/x-vertex">
        uniform float time;
        uniform vec2 resolution;
        void main()	{
            gl_Position = vec4( position, 1.0 );
        }
    </script>

  <script id="fragmentShader" type="x-shader/x-fragment">
        uniform float time;
        uniform vec2 resolution;
        void main()	{
            float x = mod(time + gl_FragCoord.x, 20.) < 10. ? 1. : 0.;
            float y = mod(time + gl_FragCoord.y, 20.) < 10. ? 1. : 0.;
            gl_FragColor = vec4(vec3(min(x, y)), 1.);
        }
    </script>
  <script>
    var container;
    var camera, scene, renderer;
    var uniforms, material, mesh;
    var mouseX = 0, mouseY = 0,
      lat = 0, lon = 0, phy = 0, theta = 0;

    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;

    init();
    var startTime = Date.now();
    animate();

    function init() {
      container = document.getElementById('container');

      camera = new THREE.Camera();
      camera.position.z = 1;
      scene = new THREE.Scene();

      uniforms = {
        time: { type: "f", value: 1.0 },
        resolution: { type: "v2", value: new THREE.Vector2() }
      };

      material = new THREE.ShaderMaterial({
        uniforms: uniforms,
        vertexShader: document.getElementById('vertexShader').textContent,
        fragmentShader: document.getElementById('fragmentShader').textContent
      });

      mesh = new THREE.Mesh(new THREE.PlaneGeometry(2, 2), material);
      scene.add(mesh);

      renderer = new THREE.WebGLRenderer();
      renderer.setPixelRatio(window.devicePixelRatio ? window.devicePixelRatio : 1);
      container.appendChild(renderer.domElement);

      uniforms.resolution.value.x = window.innerWidth;
      uniforms.resolution.value.y = window.innerHeight;
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
      requestAnimationFrame(animate);
      render();
    }

    function render() {
      var elapsedMilliseconds = Date.now() - startTime;
      var elapsedSeconds = elapsedMilliseconds / 1000.;
      uniforms.time.value = 60. * elapsedSeconds;
      renderer.render(scene, camera);
    }
  </script>
</body>

</html>
-->